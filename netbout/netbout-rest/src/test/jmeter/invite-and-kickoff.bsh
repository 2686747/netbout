/**
 * Copyright (c) 2009-2012, Netbout.com
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are PROHIBITED without prior written permission from
 * the author. This product may NOT be used anywhere and on any computer
 * except the server platform of netBout Inc. located at www.netbout.com.
 * Federal copyright law prohibits unauthorized reproduction by any means
 * and imposes fines up to $25,000 for violation. If you received
 * this code accidentally and without intent to use it, please report this
 * incident to the author by email.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */

import com.jcabi.log.Logger;
import com.netbout.spi.Query;
import com.netbout.spi.Urn;
import com.netbout.spi.client.RestSession;
import de.svenjacobs.loremipsum.LoremIpsum;
import java.util.Random;

// from Catapult/Tomcat configuration in pom.xml
sudo = "9OLKJ8JHGytfh6JGJF0LKF";

String lorem(int words) {
    return new LoremIpsum().getWords(words, random.nextInt(49) + 1);
}

try {
    random = new Random();
    home = URI.create("http://localhost:" + props.get("port"));
    user = new RestSession(home, sudo).authenticate(new Urn("urn:netbout:jmeter"), "");
    buddy = new RestSession(home, sudo).authenticate(
        new Urn("urn:netbout:buddy-" + ctx.getThread().getThreadNum()), ""
    );
    // this bout should be created before, in ReXSL tests
    bouts = user.inbox(new Query.Textual("(equal $bout.number 4)")).iterator();
    if (bouts.hasNext()) {
        bout = bouts.next();
        bout.rename(lorem(10));
        bout.invite(buddy);
        bout.post(lorem(1000));
        buddy.bout(bout.number()).leave();
        log.info("manipulated in bout " + bout.number());
    } else {
        log.info("still waiting for the first available bout");
    }
} catch (Throwable ex) {
    log.error(Logger.format("%[exception]s", new Object[] {ex}));
    IsSuccess = false;
}
